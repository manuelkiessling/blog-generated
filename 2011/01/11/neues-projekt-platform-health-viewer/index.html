<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

    <head profile="http://gmpg.org/xfn/11">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Neues Projekt: Platform Health Viewer » The Log Book of Manuel Kiessling</title>
        <meta name="description" content="Neues Projekt: Platform Health Viewer » Writings about agile software development and system operation topics" />
        <link rel="stylesheet" href="/wp-content/themes/wu-wei/style.css" type="text/css" />
        <link rel="alternate" type="application/rss+xml" title="The Log Book of Manuel Kiessling RSS Feed" href="/feed/" />
        <link rel="alternate" type="application/atom+xml" title="The Log Book of Manuel Kiessling Atom Feed" href="/feed/atom/" />
    </head>
    
    <body id="top" class="">
        <div class="full-column">
            <div class="center-column">
                <ul id="menu">
                    <li><a href="/" ><span></span><br />HOME</a></li>
                    <li><a href="/projects/"><span></span><br />PROJECTS</a></li>
                    <li><a href="/contact/"><span></span><br />CONTACT</a></li>
                    <li><a href="http://photographs.manuel.kiessling.net/"><span></span><br />PHOTOGRAPHS</a></li>
                    <li><a href="/feed/"><span></span><br />RSS</a></li>
                    <li><a href="#about"><span></span><br />ABOUT</a></li>
                </ul>
                <div class="clearboth"><!-- --></div>
            </div>
        </div>
    <div class="center-column">
        <div id="header">
            <div class="blog-name"><a href="/">The Log Book of Manuel Kiessling</a></div>
        </div>


    <div itemscope itemtype="http://schema.org/BlogPosting" class="post-247 post hentry category-software" id="post-247">
        <div class="post-info single">
            <h1><a itemprop="url" href="/2011/01/11/neues-projekt-platform-health-viewer/" rel="bookmark" title="Neues Projekt: Platform Health Viewer"><span itemprop="name">Neues Projekt: Platform Health Viewer</span></a></h1>
            <div itemprop="datePublished" content="2011-01-11" class="timestamp">January 11, 2011</div>
            <div class="clearboth"><!-- --></div>
        </div>

        <div class="post-content single">
            <div itemProp="articleBody"><p>
Platform Health Viewer (kurz PHV) ist mein aktuelles Ruby on Rails Hobbyprojekt.
</p>
<p>
Sobald es einen stabilen Zustand erreicht, wird dieses Tool das Sammeln und Visualisieren verschiedener statistischer Daten, wie sie typischerweise von Internetplattformen erzeugt werden, schnell und leichtgewichtig ermöglichen. Beispiele für diese Daten sind Dinge wie die CPU Last einzelner Systeme, Benutzerlogins, Anzahl der Seitenaufrufe usw.
</p>
<p>
Die Applikation basiert in erster Linie auf <a href="http://rubyonrails.org/">Rails</a>, der HTTP Server für die Datenanlieferung ist in <a href="http://nodejs.org/">node.js</a> geschrieben, die Weboberfläche nutzt sehr ausgiebig <a href="http://jquery.com/">jQuery</a> und für die Erzeugung von SVG Graphen die <a href="http://raphaeljs.com/">Raphaël</a> Bibliothek. Massendaten werden in SQL gespeichert, weitere Daten liegen in einer <a href="http://couchdb.apache.org/">CouchDB</a>.
</p>
<p>
Der Projektcode ist auf Github abrufbar unter <a href="https://github.com/ManuelKiessling/PlatformHealthViewer">https://github.com/ManuelKiessling/PlatformHealthViewer</a>.
</p>
<p>
Das folgende Video ist eine kurze Einführung zur aktuellen Alphaversion des Projekts. Es enthält außerdem eine lustige Sprecherstimme und eine sehr kreative Interpretation der englischen Grammatik.
</p>

<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/HI6SRqz_3D0?fs=1&amp;hl=de_DE"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/HI6SRqz_3D0?fs=1" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>

<br />
<p />
<p>

Im Folgenden das ins Deutsche übersetzte Transskript des Videos:

<blockquote>
Hi. Platform Health Viewer &#8211; oder PHV &#8211; ist mein aktuellen Hobbyprojekt.
<p/>
Ich brauche eine einfache und leichtgewichtige Möglichkeit, die verschiedenen Kennzahlen der Webseite, für die ich verantwortlich bin, zu sammeln und zu visualisieren. Sachen wie die CPU Perfomance wichtiger Systeme, Userlogins, HTTP Anfragen.
<p/>
Deshalb habe ich angefangen mit Ruby on Rails, jQuery, CouchDB und node.js zu experimentieren, und hier ist eine frühe Alphaversion, die ich demonstrieren möchte.
<p/>
Mein Hauptziel ist es, den Prozess von der Einspeisung der Daten in das System bis hin zu ihrer grafischen Visualisierung so einfach wie möglich zu gestalten.
<p/>
Um Daten in das System zu bekommen, benötigt man lediglich einen HTTP Aufruf, was es sehr einfach macht, die Daten der unterschiedlichsten Quellen zu sammeln.
<p/>
Probieren wir ein Beispiel aus. I möchte die CPU Performance meiner lokalen Maschine visualisieren.
<p/>
Ich werde diese Daten bekommen, indem ich einen Standard Unix Befehl verwende: sar.
<p/>
Dies ist ein wichtiger Aspekt meines Ansatzes: Für den Platform Health Viewer spielt es überhaupt keine Rolle, woher die Daten stammen &#8211; man ist bei den Mitteln der Datenbeschafung völlig frei. Dadurch kann man wirklich alles in das System übermitteln, angefangen bei allgemeinen Daten wie der CPU Last bis hin zu äußerst individuellen Sachen wir den Logins auf der eigenen Webseite.
<p/>
Ok, so bekomme ich den CPU &#8220;usr&#8221; Wert auf meiner OS X Kommandozeile:
<p/>
sar 1 1| grep Average| cut -b 14-15
<p/>
Fein, das wird&#8217;s tun.
<p/>
Wie liefern wir diese Werte in das System? Es reicht ein simpler HTTP Post Aufruf mithilfe von curl:
<p/>
curl &#8211;data &#8220;event[value]=`sar 1 1| grep Average| cut -b 14-15`&#038;event[source]=macbook&#038;event[name]=cpu_usr_percentage&#8221; http://localhost:3000/queue_event
<p/>
Wie man sieht, die Nutzdaten des Aufrufs bestehen aus lediglich drei Parametern: Der Quelle des Events, dem Namen des Events, und seinem Wert.
<p/>
Noch mal: Man ist an dieser Stelle komplett flexibel, man ist nicht gezwungen Eventnamen und -quellen zuvor im PHV zu konfigurieren &#8211; man definiert diese einfach im Moment der Dateneinlieferung, das das System akzeptiert diese. Wir werden gleich sehen, wie man mit den verschiedenen Events, die in das System geschrieben werden, sinnvoll umgeht.
<p/>
Ok, ich verwende jetzt ein kleines Hilfsskript das ich geschrieben habe, um die CPU sys, idle, usr und nice Werte in das System zu liefern:
<p/>
cat script/agents/macosx/cpu_overview_percent.sh
<p/>
Wie man sieht, geschieht alles unter der Verwendung normaler Unixbefehle.
<p/>
Starten wir also das Skript:
<p/>
bash ./script/agents/macosx/cpu_overview_percent.sh http://localhost:3000/ macbook
<p/>
Ich übergebe hier nur zwei Parameter, die URL zum Platform Health Viewer (der für diese Demonstration auf demselben Host läuft), und den Namen meiner Eventquelle, die ich &#8220;macbook&#8221; nenne. Eventnamen und -werten kommen direkt aus dem Hilfsskript.
<p/>
Man sieht, wie das Skript alle vier CPU Kennzahlen in das System liefert. Schauen wir uns diese Daten innerhalb des Platform Health Viewer an.
<p/>
Nun, das Dashboard ist nach wie vor leer, da wir noch keinerlei Visualisierungen definiert haben. Aber der &#8220;Tageditor&#8221; zeigt ebenfalls noch keinerlei Events an. Das liegt daran, dass die in das System eingelieferten Events noch nicht zu sogenannten Eventtypen normalisiert wurden.
<p/>
Dies ist bewusst ein zusätzlicher Schrit, denn es erlaubt dem System, eingehende Events so schnell wie möglich in die Datenbank speichern zu können, ohne sie in Hinblick auf Name und Quelle normalisieren zu müssen. Diese Normalisierung erledigt ein Rake Task:
<p/>
rake queue:convert
<p/>
Dieser Task liest die Events aus der Anlieferungs-Queue, erzeugt bei Bedarf neue Eventtypen, oder verbindet die Events mit bereits existierenden Eventtypen, falls diese bereits existieren. Abschliessend wird die Anlieferungsqueue geleert.
<p/>
Zurück im Tageditor, können wir die vier Eventtypen nun sehen.
<p/>
Ein Eventtyp ist die Kombination einer Eventquelle und eines Eventnamen, also ist &#8220;macbook &#8211; cpu_idle_percentage&#8221; ein Eventtyp.
<p/>
Schauen wir nun, wie wir den Tageditor verwenden können um etwas sinnvolles zu basteln. Das Gruppieren von einem oder mehreren Eventtypen unter einem Tag macht unsere eingelieferten Daten visualisierbar. Ich bin übrigens nicht ganz glücklich mit dem Begriff &#8220;Tag&#8221;, vielleicht fällt mir da noch etwas besseres ein.
<p/>
Wie auch immer, erzeugen wir nun einen einfachen Tag den wir benutzen können, um genau einen Wert zu visualisieren.
<p/>
Ich werde diesen Tag &#8220;macbook_cpu_usr&#8221; nennen. In diesen laufen dann alle Events, deren Quelle &#8220;macbook&#8221; und deren Name &#8220;cpu_usr_percentage&#8221; lautet. Ich könnte diese Parameter auch in die Textbox eintippen, aber es ist einfacher sie schlicht per Drag&#038;Drop in das Formular zu ziehen.
<p/>
Ok, fügen wir diesen Tag also hinzu.
<p/>
Wir haben nun also einen ersten Tag, und um zu sehen, ob er wie erwartet funktioniert, kann ich die Werte der zugeordneten Events in einer Vorschau kontrollieren.
<p/>
Liefern wir jetzt ein paar weitere Werte in das System und schauen, ob sie dann hier angezeigt werden.
<p/>
Ok, ich starte also mein Hilfsskript erneut um neue Werte in den Server zu liefern, und starte dann wiederum den Rake Task um die Werte zu normalisieren.
<p/>
Ein erneuter Klick auf &#8220;Show latest events&#8221; zeigt diese neuen Werte nun an.
<p/>
Ich starte die Datenanlieferung jetzt in einer Schleife, um viele Werte zu erhalten.
<p/>
Ok, wir haben nach wie vor keine Datenvisualisierung, also gehen wir das jetzt an. Ich wechsle in&#8217;s Dashboard und füge einen Frame hinzu, dies ist ein Container der unsere Graphen enthalten wird.
<p/>
Ein Frame ist die Visualisierung aller Werte die mit einem Tag verbunden sind, also muss ich den Namen des Tags angeben, das ich mit diesem Frame visualisieren möchte.
<p/>
&#8220;Add frame&#8221;, und los geht&#8217;s. Ein einfacher Liniengraph, der einen meiner CPU Werte repräsentiert. Der Graph ist im Übrigen ein SVG, erzeugt mit Raphael, einer fantastischen JavaScript Bibliothek.
<p/>
Und dank jQuery kann ich diesen Graphen frei bewegen und skalieren.
<p/>
Erzeugen wir nun einen Graphen für alle meine CPU Werte. Zurück im Tageditor ziehe ich nun alle meine Eventtypen zusammen.
<p/>
Ich kann übrigens Tags erzeugen, indem ich Eventquellen und -namen mit bereits existierenden Tags kombiniere, wie man hier sieht.
<p/>
Ich überprüfe alle Werte die meinem neuen Tag zugeordnet sind, und dort sieht man alle CPU Werte, die mein Skript gesammelt hat.
<p/>
Wieder zurück im Dashboard gehe ich her und erzeuge einen weiteren Frame, für meinen neuen Tag. Wie man sieht, enthält dieser Frame vier Liniengraphen und zeigt mir so eine hübsche Übersicht meiner kompletten CPU Performance. Natürlich wird hier eine Legende benötigt, etwas das bisher noch nicht implementiert ist.
<p/>
Nun, das ist es, das ist der aktuelle Stand des Projekts. Ich würde mich sehr über Feedback freuen, der Code kann auf Github geforkt werden oder schreibt mir eine Mail.
<p/>
Danke für&#8217;s Interesse.
</blockquote>

</p></div>
            <div id="twitterfollow">
                <span class="note">If you would like to be informed on updates to this post, just <a href="https://twitter.com/manuelkiessling">follow @manuelkiessling</a></span>
            </div>
                    </div>
        <div class="clearboth"><!-- --></div>
    </div>

    <a name="comments" />
    
<!-- You can start editing here. -->

<div id="comment-wrapper">

                     <div id="disqus_thread"></div>
                     <script type="text/javascript">
                      var disqus_shortname = 'thelogbookofmanuelkiessling';
                      var disqus_identifier = '247';
                      var disqus_url = 'http://manuel.kiessling.net/2011/01/11/neues-projekt-platform-health-viewer/';
                      (function() {
                       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                       dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                      })();
                     </script>
                     <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div> <!-- end of comment-wrapper -->


            <a name="about"/>
            <div id="footer">
                <div class="image">
                    <img src="http://www.gravatar.com/avatar/8b50d5d8199a12f00cfbfd1061e224a9.png?s=160" width="160" alt="Photograph of Manuel Kiessling" title="Manuel Kiessling" />
                </div>
                <div class="text">
                    <p>
                        This is the homepage and blog of <a href="https://plus.google.com/100272082905360445612?rel=author">Manuel Kiessling</a>. 
                    </p>
                    <p>
                        I'm a software architect, test driven developer, linux admin, agilist, the author of <a href="http://www.nodebeginner.org/">NodeBeginner.org</a>, and father of two.
                    </p>
                    <p>
                        Follow me on Twitter: <a href="http://twitter.com/manuelkiessling">@manuelkiessling</a>
                    </p>
                </div>
            </div>
        </div>

        <script type="text/javascript">
        
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-2127388-5']);
          _gaq.push(['_trackPageview']);
        
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        
        </script>

    </body>
</html>
